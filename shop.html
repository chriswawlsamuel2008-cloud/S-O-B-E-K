<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shop ‚Äì SGWEN X</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#6a11cb,#2575fc);
  color:#fff;
}
nav{
  display:flex;
  justify-content:center;
  padding:20px;
  background:rgba(0,0,0,.5);
}
nav ul{list-style:none;display:flex;gap:40px;padding:0;margin:0}
nav a{color:#ffd700;text-decoration:none;font-weight:600}

#password-screen{
  height:80vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:10px;
}
.pass-box{position:relative}
.pass-box input{
  padding:12px 40px 12px 12px;
  border-radius:6px;border:none
}
.eye{
  position:absolute;right:10px;top:50%;
  transform:translateY(-50%);
  cursor:pointer;color:#000
}
#password-screen button{
  padding:10px 25px;border:none;border-radius:6px;
  background:#ffd700;cursor:pointer
}

#shop-content{display:none;padding:40px;text-align:center}

.items{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;margin-top:20px
}
.box{
  background:rgba(255,255,255,.15);
  padding:20px;border-radius:12px
}
.counter{display:flex;justify-content:center;gap:10px}
.counter button{
  width:30px;border:none;background:#ffd700;cursor:pointer
}
.add{margin-top:10px;padding:8px 20px;border:none;background:#ffd700;cursor:pointer}

#order-box{
  margin-top:30px;
  background:rgba(255,255,255,.15);
  padding:20px;border-radius:12px
}
#send-btn{
  margin-top:15px;padding:10px 30px;
  background:green;color:#fff;border:none;cursor:pointer
}
</style>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>

<body>

<nav>
  <ul>
    <li><a href="home.html">Home</a></li>
    <li><a href="archive.html">Archive</a></li>
    <li><a href="gallery.html">Gallery</a></li>
    <li><a href="calendar.html">Calendar</a></li>
  </ul>
</nav>

<!-- PASSWORD -->
<div id="password-screen">
  <h2>Enter Password</h2>
  <div class="pass-box">
    <input type="password" id="pass">
    <span class="eye" id="eye">üëÅÔ∏è</span>
  </div>
  <button id="enterBtn">Enter</button>
</div>

<!-- SHOP -->
<div id="shop-content">
  <h2 id="welcome">Shop</h2>

  <div class="items">
    <div class="box">
      <h3>Tent</h3>
      <div class="counter">
        <button onclick="change('tent',-1)">-</button>
        <span id="tent">0</span>
        <button onclick="change('tent',1)">+</button>
      </div>
      <button class="add" onclick="addItem('Tent')">Add</button>
    </div>

    <div class="box">
      <h3>Rope</h3>
      <div class="counter">
        <button onclick="change('rope',-1)">-</button>
        <span id="rope">0</span>
        <button onclick="change('rope',1)">+</button>
      </div>
      <button class="add" onclick="addItem('Rope')">Add</button>
    </div>

    <div class="box">
      <h3>Wood</h3>
      <div class="counter">
        <button onclick="change('wood',-1)">-</button>
        <span id="wood">0</span>
        <button class="add" onclick="addItem('Wood')">Add</button>
      </div>
    </div>

    <div class="box">
      <h3>Pots</h3>
      <div class="counter">
        <button onclick="change('pots',-1)">-</button>
        <span id="pots">0</span>
        <button class="add" onclick="addItem('Pots')">Add</button>
      </div>
    </div>
  </div>

  <div id="order-box">
    <h3>Your Order</h3>
    <div id="order-items"></div>
    <button id="send-btn">Send Order</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyDMzEwys8RxGsehCJ2VlrnJeiAa_WY9Lgc",
  authDomain: "sgwen-x.firebaseapp.com",
  projectId: "sgwen-x"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* Get username from Firestore */
let userName = "Unknown";
onAuthStateChanged(auth, async(user)=>{
  if(user){
    const docRef = doc(db,"users",user.uid);
    const docSnap = await getDoc(docRef);
    if(docSnap.exists()){
      userName = docSnap.data().name;
      document.getElementById("welcome").innerText = "Logged in by: " + userName;
      console.log("Firebase name:", userName);
    } else {
      console.log("No user doc found for this UID!");
    }
  } else {
    console.log("User not logged in");
  }
});

/* Password toggle */
const passInput = document.getElementById("pass");
document.getElementById("eye").onclick = ()=>{
  passInput.type = passInput.type==="password" ? "text" : "password";
};
document.getElementById("enterBtn").onclick = ()=>{
  if(passInput.value==="sgwen123"){
    document.getElementById("password-screen").style.display="none";
    document.getElementById("shop-content").style.display="block";
  } else alert("Wrong password");
};

/* Order system */
let order = {}; // object for each item
window.change = (id,val)=>{
  const el = document.getElementById(id);
  let n = parseInt(el.innerText)+val;
  if(n<0)n=0;
  el.innerText=n;
};

window.addItem = (name)=>{
  const qty = parseInt(document.getElementById(name.toLowerCase()).innerText);
  if(qty===0) return alert("Quantity must be > 0");
  order[name] = qty;
  updateOrderDisplay();
};

function updateOrderDisplay(){
  const container = document.getElementById("order-items");
  container.innerHTML = Object.keys(order).map(k=>`${k} x ${order[k]}`).join("<br>");
}

/* EmailJS */
emailjs.init("R343iEUpx16F3VYfz");

document.getElementById("send-btn").onclick = ()=>{
  if(Object.keys(order).length===0){
    alert("No items added");
    return;
  }

  emailjs.send("service_21rqokl","template_hwaelip",{
    user: userName,
    order: Object.keys(order).map(k=>`${k} x ${order[k]}`).join("\n")
  }).then(()=>{
    alert("Order sent ‚úÖ");
    order={};
    document.getElementById("order-items").innerHTML="";
    ["tent","rope","wood","pots"].forEach(i=>document.getElementById(i).innerText="0");
  }).catch(err=>{
    alert("Send failed ‚ùå");
    console.log(err);
  });
};
</script>

</body>
</html>
